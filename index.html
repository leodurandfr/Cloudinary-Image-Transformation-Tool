<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudinary Transform Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .controls-section, .preview-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }

        .card h2 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 2px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .dimension-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .aspect-ratio-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .aspect-btn {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .aspect-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .aspect-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .gravity-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .gravity-btn {
            padding: 10px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            font-weight: 600;
            text-align: center;
        }

        .gravity-btn:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .gravity-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .preview-container {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #dee2e6;
            position: relative;
            overflow: hidden;
        }

        .preview-container img {
            max-width: 100%;
            max-height: 600px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .preview-placeholder {
            text-align: center;
            color: #adb5bd;
        }

        .preview-placeholder svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .url-output {
            background: #212529;
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .copy-btn.copied {
            background: #28a745;
        }

        .toggle-section {
            margin-top: 10px;
        }

        .toggle-header {
            cursor: pointer;
            padding: 12px;
            background: #e9ecef;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .toggle-header:hover {
            background: #dee2e6;
        }

        .toggle-content {
            margin-top: 15px;
            display: none;
        }

        .toggle-content.active {
            display: block;
        }

        .effects-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .effect-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .effect-checkbox:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .effect-checkbox input {
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .info-badge {
            display: inline-block;
            background: #e7f3ff;
            color: #0066cc;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .reset-btn {
            width: 100%;
            padding: 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            margin-top: 10px;
        }

        .reset-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Cloudinary Transform Tool</h1>
            <p>G√©n√©rateur de transformations d'images en temps r√©el</p>
        </div>

        <div class="main-content">
            <!-- Controls Section -->
            <div class="controls-section">
                <!-- URL Input -->
                <div class="card">
                    <h2>URL de l'image</h2>
                    <div class="input-group">
                        <label for="imageUrl">Collez votre URL Cloudinary</label>
                        <input 
                            type="text" 
                            id="imageUrl" 
                            placeholder="https://www.chanel.com/images/..."
                            value=""
                        >
                    </div>
                    <button class="reset-btn" onclick="resetAll()">üîÑ R√©initialiser</button>
                </div>

                <!-- Crop Mode -->
                <div class="card">
                    <h2>Mode de recadrage</h2>
                    <div class="input-group">
                        <label for="cropMode">Crop Mode</label>
                        <select id="cropMode" onchange="updateTransform()">
                            <option value="">Aucun</option>
                            <option value="fill">Fill - Remplir les dimensions</option>
                            <option value="lfill">Limit Fill - Fill limit√©</option>
                            <option value="crop">Crop - Rogner</option>
                            <option value="thumb">Thumb - Miniature</option>
                            <option value="auto">Auto - Automatique</option>
                            <option value="scale">Scale - Redimensionner</option>
                            <option value="fit">Fit - Ajuster</option>
                            <option value="limit">Limit - Limiter</option>
                            <option value="mfit">Min Fit - Ajustement minimum</option>
                            <option value="pad">Pad - Avec padding</option>
                            <option value="lpad">Limit Pad - Pad limit√©</option>
                            <option value="mpad">Min Pad - Pad minimum</option>
                        </select>
                    </div>
                </div>

                <!-- Dimensions -->
                <div class="card">
                    <h2>Dimensions</h2>
                    <div class="input-group">
                        <label>Largeur & Hauteur (pixels)</label>
                        <div class="dimension-inputs">
                            <input 
                                type="number" 
                                id="width" 
                                placeholder="Largeur"
                                onchange="updateTransform()"
                            >
                            <input 
                                type="number" 
                                id="height" 
                                placeholder="Hauteur"
                                onchange="updateTransform()"
                            >
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Ratio d'aspect pr√©d√©finis</label>
                        <div class="aspect-ratio-buttons">
                            <button class="aspect-btn" onclick="setAspectRatio('1:1')">1:1</button>
                            <button class="aspect-btn" onclick="setAspectRatio('4:3')">4:3</button>
                            <button class="aspect-btn" onclick="setAspectRatio('16:9')">16:9</button>
                            <button class="aspect-btn" onclick="setAspectRatio('3:2')">3:2</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="aspectRatio">Ratio personnalis√© (ex: 1.5 ou 16:9)</label>
                        <input 
                            type="text" 
                            id="aspectRatio" 
                            placeholder="1.0 ou 16:9"
                            onchange="updateTransform()"
                        >
                    </div>
                </div>

                <!-- Gravity -->
                <div class="card">
                    <h2>Gravit√© (point focal)</h2>
                    <div class="input-group">
                        <label>Position compass</label>
                        <div class="gravity-grid">
                            <button class="gravity-btn" onclick="setGravity('north_west')">‚Üñ NW</button>
                            <button class="gravity-btn" onclick="setGravity('north')">‚Üë N</button>
                            <button class="gravity-btn" onclick="setGravity('north_east')">‚Üó NE</button>
                            <button class="gravity-btn" onclick="setGravity('west')">‚Üê W</button>
                            <button class="gravity-btn" onclick="setGravity('center')">‚äô C</button>
                            <button class="gravity-btn" onclick="setGravity('east')">‚Üí E</button>
                            <button class="gravity-btn" onclick="setGravity('south_west')">‚Üô SW</button>
                            <button class="gravity-btn" onclick="setGravity('south')">‚Üì S</button>
                            <button class="gravity-btn" onclick="setGravity('south_east')">‚Üò SE</button>
                        </div>
                    </div>

                    <div class="input-group" style="margin-top: 15px;">
                        <label for="gravitySpecial">Gravit√© sp√©ciale</label>
                        <select id="gravitySpecial" onchange="setGravity(this.value)">
                            <option value="">Aucune</option>
                            <option value="auto">Auto - Automatique</option>
                            <option value="face">Face - Visage</option>
                            <option value="faces">Faces - Plusieurs visages</option>
                            <option value="auto:face">Auto:Face - Auto sur visage</option>
                            <option value="auto:faces">Auto:Faces - Auto sur visages</option>
                        </select>
                    </div>
                </div>

                <!-- Effects -->
                <div class="card">
                    <h2>Effets & Qualit√©</h2>
                    
                    <div class="toggle-section">
                        <div class="toggle-header" onclick="toggleSection('effects')">
                            <span>üé® Effets visuels</span>
                            <span>‚ñº</span>
                        </div>
                        <div id="effects" class="toggle-content">
                            <div class="effects-grid">
                                <label class="effect-checkbox">
                                    <input type="checkbox" value="grayscale" onchange="updateTransform()">
                                    <span>Grayscale</span>
                                </label>
                                <label class="effect-checkbox">
                                    <input type="checkbox" value="sharpen" onchange="updateTransform()">
                                    <span>Sharpen</span>
                                </label>
                                <label class="effect-checkbox">
                                    <input type="checkbox" value="upscale" onchange="updateTransform()">
                                    <span>Upscale</span>
                                </label>
                                <label class="effect-checkbox">
                                    <input type="checkbox" value="gen_restore" onchange="updateTransform()">
                                    <span>Gen Restore</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group" style="margin-top: 15px;">
                        <label for="quality">Qualit√©</label>
                        <select id="quality" onchange="updateTransform()">
                            <option value="">Par d√©faut</option>
                            <option value="auto">Auto</option>
                            <option value="auto:best">Auto:Best</option>
                            <option value="auto:good">Auto:Good</option>
                            <option value="auto:eco">Auto:Eco</option>
                            <option value="auto:low">Auto:Low</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="format">Format</label>
                        <select id="format" onchange="updateTransform()">
                            <option value="">Original</option>
                            <option value="auto">Auto</option>
                            <option value="jpg">JPEG</option>
                            <option value="png">PNG</option>
                            <option value="webp">WebP</option>
                            <option value="avif">AVIF</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="dpr">DPR (Device Pixel Ratio)</label>
                        <select id="dpr" onchange="updateTransform()">
                            <option value="">Par d√©faut</option>
                            <option value="1.0">1.0</option>
                            <option value="1.5">1.5</option>
                            <option value="2.0">2.0</option>
                            <option value="3.0">3.0</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="preview-section">
                <!-- Preview -->
                <div class="card">
                    <h2>Aper√ßu <span class="info-badge">Live</span></h2>
                    <div class="preview-container" id="previewContainer">
                        <div class="preview-placeholder">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            <p>Collez une URL d'image pour voir l'aper√ßu</p>
                        </div>
                    </div>
                </div>

                <!-- Generated URL -->
                <div class="card">
                    <h2>URL g√©n√©r√©e</h2>
                    <div style="position: relative;">
                        <div class="url-output" id="urlOutput">
                            Aucune URL g√©n√©r√©e
                        </div>
                        <button class="copy-btn" id="copyBtn" onclick="copyUrl()">Copier</button>
                    </div>
                </div>

                <!-- Info -->
                <div class="card" style="background: #e7f3ff; border-color: #b3d9ff;">
                    <h2 style="color: #0066cc;">üí° Informations</h2>
                    <ul style="margin-left: 20px; color: #004080; line-height: 1.8;">
                        <li>L'aper√ßu se met √† jour en temps r√©el</li>
                        <li>Compatible avec les URLs Chanel et Cloudinary standards</li>
                        <li>Tous les param√®tres sont optionnels</li>
                        <li>Les transformations sont cumulables</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUrl = '';
        let baseUrl = '';
        let publicId = '';
        let currentGravity = '';

        // Initialize
        document.getElementById('imageUrl').addEventListener('input', function(e) {
            parseUrl(e.target.value);
            updateTransform();
        });

        function parseUrl(url) {
            if (!url) {
                currentUrl = '';
                baseUrl = '';
                publicId = '';
                return;
            }

            currentUrl = url;

            // Parse Chanel URLs
            if (url.includes('chanel.com/images')) {
                const parts = url.split('/images/');
                baseUrl = parts[0] + '/images/';
                
                // Extract public ID (filename)
                const remaining = parts[1];
                const pathParts = remaining.split('/');
                publicId = pathParts[pathParts.length - 1];
            } 
            // Parse standard Cloudinary URLs
            else if (url.includes('res.cloudinary.com')) {
                const match = url.match(/(https:\/\/res\.cloudinary\.com\/[^\/]+\/[^\/]+\/[^\/]+\/)/);
                if (match) {
                    baseUrl = match[1];
                    publicId = url.split('/').pop();
                }
            }
            // Generic URL
            else {
                const urlParts = url.split('/');
                publicId = urlParts.pop();
                baseUrl = urlParts.join('/') + '/';
            }
        }

        function buildTransformUrl() {
            if (!currentUrl) return '';

            const transforms = [];

            // Crop mode
            const cropMode = document.getElementById('cropMode').value;
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            const aspectRatio = document.getElementById('aspectRatio').value;

            let cropParams = [];
            
            if (cropMode) {
                cropParams.push(`c_${cropMode}`);
            }
            
            if (width) {
                cropParams.push(`w_${width}`);
            }
            
            if (height) {
                cropParams.push(`h_${height}`);
            }
            
            if (aspectRatio) {
                cropParams.push(`ar_${aspectRatio}`);
            }

            if (currentGravity) {
                cropParams.push(`g_${currentGravity}`);
            }

            if (cropParams.length > 0) {
                transforms.push(cropParams.join(','));
            }

            // Effects
            const effectCheckboxes = document.querySelectorAll('.effect-checkbox input:checked');
            effectCheckboxes.forEach(cb => {
                if (cb.value === 'upscale') {
                    transforms.push(`e_upscale`);
                } else if (cb.value === 'gen_restore') {
                    transforms.push(`e_gen_restore`);
                } else {
                    transforms.push(`e_${cb.value}`);
                }
            });

            // Quality
            const quality = document.getElementById('quality').value;
            if (quality) {
                transforms.push(`q_${quality}`);
            }

            // Format
            const format = document.getElementById('format').value;
            if (format) {
                transforms.push(`f_${format}`);
            }

            // DPR
            const dpr = document.getElementById('dpr').value;
            if (dpr) {
                transforms.push(`dpr_${dpr}`);
            }

            // Build final URL
            if (transforms.length === 0) {
                return currentUrl;
            }

            const transformString = transforms.join('/');
            return baseUrl + transformString + '/' + publicId;
        }

        function updateTransform() {
            const newUrl = buildTransformUrl();
            
            // Update URL output
            document.getElementById('urlOutput').textContent = newUrl || 'Aucune URL g√©n√©r√©e';

            // Update preview
            const previewContainer = document.getElementById('previewContainer');
            if (newUrl) {
                previewContainer.innerHTML = `<img src="${newUrl}" alt="Preview" onerror="this.src=''; this.alt='Erreur de chargement'">`;
            } else {
                previewContainer.innerHTML = `
                    <div class="preview-placeholder">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                            <polyline points="21 15 16 10 5 21"></polyline>
                        </svg>
                        <p>Collez une URL d'image pour voir l'aper√ßu</p>
                    </div>
                `;
            }
        }

        function setAspectRatio(ratio) {
            document.getElementById('aspectRatio').value = ratio;
            
            // Update button states
            document.querySelectorAll('.aspect-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateTransform();
        }

        function setGravity(gravity) {
            currentGravity = gravity;
            
            // Update button states
            document.querySelectorAll('.gravity-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (event.target.classList.contains('gravity-btn')) {
                event.target.classList.add('active');
            }
            
            // Reset special gravity select if compass was clicked
            if (gravity && !gravity.includes('auto') && !gravity.includes('face')) {
                document.getElementById('gravitySpecial').value = '';
            }
            
            updateTransform();
        }

        function copyUrl() {
            const urlText = document.getElementById('urlOutput').textContent;
            const copyBtn = document.getElementById('copyBtn');
            
            navigator.clipboard.writeText(urlText).then(() => {
                copyBtn.textContent = '‚úì Copi√© !';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = 'Copier';
                    copyBtn.classList.remove('copied');
                }, 2000);
            });
        }

        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('active');
            
            const header = section.previousElementSibling;
            const arrow = header.querySelector('span:last-child');
            arrow.textContent = section.classList.contains('active') ? '‚ñ≤' : '‚ñº';
        }

        function resetAll() {
            document.getElementById('imageUrl').value = '';
            document.getElementById('cropMode').value = '';
            document.getElementById('width').value = '';
            document.getElementById('height').value = '';
            document.getElementById('aspectRatio').value = '';
            document.getElementById('gravitySpecial').value = '';
            document.getElementById('quality').value = '';
            document.getElementById('format').value = '';
            document.getElementById('dpr').value = '';
            
            currentGravity = '';
            currentUrl = '';
            baseUrl = '';
            publicId = '';
            
            document.querySelectorAll('.aspect-btn, .gravity-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('.effect-checkbox input').forEach(cb => {
                cb.checked = false;
            });
            
            updateTransform();
        }

        // Add example URLs for testing
        setTimeout(() => {
            const exampleUrl = 'https://www.chanel.com/images//t_one///q_auto:good,f_autoplus,fl_lossy,dpr_1.1/w_1240/camelia-bloom-supple-cuff-white-white-gold-diamond-packshot-default-j13524-9580730875934.jpg';
            console.log('üí° Exemple d\'URL √† tester:', exampleUrl);
        }, 1000);
    </script>
</body>
</html>